(function(){var $,Like,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};$=jQuery,Like=function(){function Like(el,options){this.apiError=bind(this.apiError,this),this.removeLike=bind(this.removeLike,this),this.addLike=bind(this.addLike,this),this.sendLike=bind(this.sendLike,this),this.el=$(el),this.options=$.extend({},this.defaults,options),this.isSending=!1,this.setUp()}return Like.prototype.defaults={csrfToken:"csrf_token",likeText:"like ({count})",removeLikeText:"remove like ({count})"},Like.prototype.setUp=function(){return this.el.on("click",this.sendLike),this.el.on("click",this.stopClick)},Like.prototype.sendLike=function(){var post;this.isSending||(this.isSending=!0,post=$.post(this.el.attr("href"),{csrfmiddlewaretoken:this.options.csrfToken}),post.done(function(_this){return function(data){return data.url_delete?_this.addLike(data):data.url_create?_this.removeLike(data):_this.apiError()}}(this)),post.always(function(_this){return function(){return _this.isSending=!1}}(this)))},Like.prototype.addLike=function(data){var count,removeLikeText;return this.el.attr("href",data.url_delete),count=this.el.data("count"),count+=1,this.el.data("count",count),removeLikeText=$.format(this.options.removeLikeText,{count:count}),this.el.text(removeLikeText)},Like.prototype.removeLike=function(data){var count,likeText;return this.el.attr("href",data.url_create),count=this.el.data("count"),count-=1,this.el.data("count",count),likeText=$.format(this.options.likeText,{count:count}),this.el.text(likeText)},Like.prototype.apiError=function(){return this.el.text("api error")},Like.prototype.stopClick=function(e){e.preventDefault(),e.stopPropagation()},Like}(),$.fn.extend({like:function(options){return this.each(function(){return $(this).data("plugin_like")?void 0:$(this).data("plugin_like",new Like(this,options))})}}),$.fn.like.Like=Like}).call(this);